{% extends "base.html" %}

{% block title %}ちいさなキロク / コメント編集{% endblock %}

{% block contents %}
{% load static %}
<link rel="stylesheet" href="{% static 'calendarapp/calendar.css' %}">

<!-- メインコンテンツ -->
<main class="main-content">
  <div class="edit-container">
    <h2 class="page-title">コメント編集</h2>

    {% if record.image %}
      <div class="image-preview">
        <img src="{{ record.image.url }}" alt="添付画像" id="preview-img">
      </div>
    {% else %}
      <div class="image-preview" id="image-preview-container" style="display: none;">
        <img src="" alt="プレビュー" id="preview-img">
      </div>
      <p class="no-image-text" id="no-image-text">画像は未登録です</p>
    {% endif %}

    <form method="post" enctype="multipart/form-data" class="edit-form">
      {% csrf_token %}
      
      <div class="form-group">
        <label for="id_image">画像:</label>
        <div class="file-input-wrapper">
          <label for="id_image" class="file-input-label">
            ファイルを選択
          </label>
          <input type="file" name="image" accept="image/*" id="id_image" class="file-input">
          <span class="file-name" id="file-name">選択されていません</span>
        </div>
      </div>

      <div class="form-group">
        <label for="{{ form.comment.id_for_label }}">Comment:</label>
        {{ form.comment }}
      </div>

      <button type="submit" class="save-button">保存</button>
    </form>
  </div>
</main>

<style>
  /* bodyの背景色を上書き */
  body {
    background-color: #f5f5f5 !important;
  }

  /* メインコンテンツ */
  .main-content {
    background-color: #f5f5f5;
    min-height: calc(100vh - 100px);
    padding: 50px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .edit-container {
    background-color: #fff;
    border: 2px solid #ddd;
    border-radius: 20px;
    padding: 40px;
    max-width: 600px;
    width: 100%;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  .page-title {
    color: #333;
    font-size: 24px;
    margin-bottom: 30px;
    font-weight: normal;
  }

  .image-preview {
    margin-bottom: 20px;
    text-align: center;
  }

  .image-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 10px;
    border: 1px solid #ddd;
  }

  .no-image-text {
    color: #666;
    margin-bottom: 20px;
    font-size: 16px;
  }

  /* フォーム */
  .edit-form {
    width: 100%;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    color: #333;
    display: block;
    margin-bottom: 10px;
    font-size: 16px;
  }

  /* ファイル入力 */
  .file-input-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .file-input {
    display: none;
  }

  .file-input-label {
    padding: 10px 20px;
    background-color: #8b7355;
    color: #fff !important;  /* 白色に変更 */
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
  }

  .file-input-label:hover {
    background-color: #6d5a43;
  }

  .file-name {
    color: #666;
    font-size: 14px;
  }

  .form-group textarea {
    width: 100%;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
    min-height: 100px;
    resize: vertical;
    box-sizing: border-box;
  }

  .save-button {
    width: 100%;
    padding: 15px;
    background-color: #8b7355;
    color: #fff;
    border: none;
    border-radius: 50px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .save-button:hover {
    background-color: #6d5a43;
  }

  /* 全体のフォント統一 */
  * {
    font-family: 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', 'メイリオ', Meiryo, 'ＭＳ Ｐゴシック', 'MS PGothic', sans-serif;
  }
</style>

<script>
  // ファイル選択時の処理
  document.getElementById('id_image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const fileName = document.getElementById('file-name');
    const previewContainer = document.getElementById('image-preview-container');
    const previewImg = document.getElementById('preview-img');
    const noImageText = document.getElementById('no-image-text');
    
    if (file) {
      // ファイル名を表示
      fileName.textContent = file.name;
      
      // 画像プレビューを表示
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImg.src = e.target.result;
        if (previewContainer) {
          previewContainer.style.display = 'block';
        }
        if (noImageText) {
          noImageText.style.display = 'none';
        }
      };
      reader.readAsDataURL(file);
    } else {
      fileName.textContent = '選択されていません';
    }
  });
</script>
{% endblock %}